#!/bin/sh

ROOTFS=/rootfs
RASPDIR=$ROOTFS/root/RASP
RASPURL=https://github.com/nilx/RASP.git

CRONTAB=$ROOTFS/etc/crontab

# get RASP code
rm -rf $RASPDIR
# TODO: use wget+unzip instead?
git clone $RASPURL $RASPDIR

# run on reboot
cat <<EOF >> $CRONTAB
@reboot root test -f /root/RASP/update-on-reboot && /root/RASP/scripts/update >> /var/log/rasp-update.log; rm /root/RASP/update-on-reboot
EOF

touch $RASPDIR/update-on-reboot
