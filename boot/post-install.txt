#!/bin/sh

ROOT=/rootfs

# red+green heartbeat = setup
echo heartbeat > /sys/class/leds/led0/trigger
echo heartbeat > /sys/class/leds/led1/trigger

# get RASP code
cd $ROOT/root
git clone https://github.com/nilx/RASP.git
cd RASP/chef

# run chef recipes
CHEFOPTS="-z -c client.rb"
chef-client $CHEFOPTS r 'recipe[rasp-base-setup::heartbeat]'
chef-client $CHEFOPTS r 'recipe[rasp-base-setup::motd]'
chef-client $CHEFOPTS r 'recipe[rasp-base-setup::packages]'
chef-client $CHEFOPTS r 'recipe[rasp-base-setup::firmware]'
chef-client $CHEFOPTS r 'recipe[rasp-base-setup::rng]'

