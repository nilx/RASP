#!/bin/sh

ROOT=/rootfs

# red+green heartbeat = setup
echo heartbeat > /sys/class/leds/led0/trigger
echo heartbeat > /sys/class/leds/led1/trigger

# get RASP code
cd $ROOT/root
git clone https://github.com/nilx/RASP.git
cd RASP/chef

# run chef recipes
CHEFOPTS="-z -c client.rb"
RECIPES=
RECIPES="${RECIPES}recipe[rasp-base-setup::heartbeat],"
RECIPES="${RECIPES}recipe[rasp-base-setup::motd],"
RECIPES="${RECIPES}recipe[rasp-base-setup::packages],"
RECIPES="${RECIPES}recipe[rasp-base-setup::firmware],"
RECIPES="${RECIPES}recipe[rasp-base-setup::rng],"

chef-client $CHEFOPTS -r $RECIPES
